//////////////// 1  << OK

SELECT JOB_TITLE , COUNT(E1.EMPLOYEE_ID) AS MANAGER_COUNT
FROM EMPLOYEES E1
JOIN JOBS ON JOBS.JOB_ID = E1.JOB_ID
WHERE EXISTS (SELECT MANAGER_ID FROM EMPLOYEES E2 WHERE E2.MANAGER_ID = E1.EMPLOYEE_ID )
GROUP BY JOB_TITLE
ORDER BY JOB_TITLE;



/////////////   2   << OK

SELECT DEPARTMENT_NAME,E1.first_name || ' ' || E1.last_name, TO_CHAR(E1.HIRE_DATE,'DD-MON-YY')
FROM EMPLOYEES E1
JOIN DEPARTMENTS ON E1.department_id = DEPARTMENTS.DEPARTMENT_ID
LEFT JOIN EMPLOYEES E2 ON E2.HIRE_DATE > E1.HIRE_DATE and E1.department_id = E2.department_id
GROUP BY E1.last_name,E1.first_name,DEPARTMENT_NAME,E1.HIRE_DATE
HAVING COUNT(DISTINCT E2.HIRE_DATE)<3
ORDER BY DEPARTMENT_NAME,COUNT(DISTINCT E2.HIRE_DATE);



//////////////////// 3 << OK

SELECT E1.first_name || ' ' || E1.last_name AS NAME, REGIONS.REGION_NAME
FROM EMPLOYEES E1
JOIN DEPARTMENTS ON E1.DEPARTMENT_ID = DEPARTMENTS.DEPARTMENT_ID
JOIN LOCATIONS ON DEPARTMENTS.location_id = LOCATIONS.LOCATION_ID
JOIN COUNTRIES ON LOCATIONS.COUNTRY_ID = COUNTRIES.COUNTRY_ID
JOIN REGIONS ON COUNTRIES.REGION_ID = REGIONS.REGION_ID
WHERE REGIONS.REGION_NAME = (
	SELECT REGION_NAME
	FROM EMPLOYEES E2
	JOIN DEPARTMENTS ON E2.DEPARTMENT_ID = DEPARTMENTS.DEPARTMENT_ID
	JOIN LOCATIONS ON DEPARTMENTS.location_id = LOCATIONS.LOCATION_ID
	JOIN COUNTRIES ON LOCATIONS.COUNTRY_ID = COUNTRIES.COUNTRY_ID
	JOIN REGIONS ON COUNTRIES.REGION_ID = REGIONS.REGION_ID
	WHERE E2.EMPLOYEE_ID = E1.MANAGER_ID
)
ORDER BY EMPLOYEE_ID;



///////////////// 4

SELECT E1.first_name || ' ' || E1.last_name AS NAME, E1.JOB_ID,E1.HIRE_DATE
FROM EMPLOYEES E1
JOIN EMPLOYEES E2 ON E1.JOB_ID = E2.JOB_ID
HAVING COUNT(E2.JOB_ID) <= 2*(
	SELECT COUNT(*) FROM 
	EMPLOYEES E3
	WHERE E3.HIRE_DATE<E1.HIRE_DATE
			AND E3.JOB_ID = E1.JOB_ID
)
GROUP BY E1.first_name,E1.last_name, E1.JOB_ID,E1.HIRE_DATE
ORDER BY JOB_ID;



//////////////// 5

SELECT COUNT(DISTINCT E2.MANAGER_COUNT) + 1 AS RANK , E1.JOB_ID,E1.MANAGER_COUNT
FROM (SELECT COUNT(DISTINCT MANAGER_ID) AS MANAGER_COUNT,JOB_ID
FROM EMPLOYEES
GROUP BY JOB_ID) E1
LEFT JOIN ((SELECT COUNT(DISTINCT MANAGER_ID) AS MANAGER_COUNT,JOB_ID
FROM EMPLOYEES
GROUP BY JOB_ID)) E2 ON E2.MANAGER_COUNT > E1.MANAGER_COUNT
GROUP BY E1.JOB_ID,E1.MANAGER_COUNT
ORDER BY COUNT(DISTINCT E2.MANAGER_COUNT);